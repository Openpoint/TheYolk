<!DOCTYPE html>
<html ng-app="yolk">
    <head>
        <meta charset="UTF-8">
        <script>
            window.$ = window.jQuery = require('jquery');
            window.Promise = require("bluebird");
            const {ipcRenderer} = require('electron');
			const smartcrop = require('smartcrop');
            require('jquery.facedetection');
        </script>
    </head>
    <body>
        <script>
            var face = function(src,discoq){
				src = decodeURI(src);
                var promise = new Promise(function(resolve,reject){
                    var image = document.createElement('img');
                    $(image).attr('src',src);

                    image.onload = function(){
                        try{
                            $(image).faceDetection({
                                complete: function (data) {
									var confidence;
									var options = {
										width: 250,
										height:250
									}
									if (data.length){
										data.forEach(function(face){
											if(!confidence){
												confidence = face.confidence;
											}else if(face.confidence > confidence){
												confidence = face.confidence;
											}
										})
										data = data.filter(function(face){
											if(face.confidence === confidence){
												return true;
											}
										})
										var boost = data.map(function(face){
											return {
												x:face.x,
												y:face.y,
												width:face.width,
												height:face.height,
												weight:1
											}
										})
										options.boost = boost;
										smartcrop.crop(image,options).then(function(result){
											$(image).remove();
											resolve(result.topCrop)
										})
									}else{
										smartcrop.crop(image,options).then(function(result){
											$(image).remove();
											resolve(result.topCrop)
										})
									}
                                }
                            });
                        }
                        catch(err){
                            reject(err);
                        }
                    }
                })
                return promise;
            }
        </script>
    </body>
</html>
