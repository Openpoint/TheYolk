<!DOCTYPE html>
<html ng-app="yolk">
    <head>
        <meta charset="UTF-8">
		<!--
		Copyright 2017 Michael Jonker (http://openpoint.ie)
		This file is part of The Yolk.
		The Yolk is free software: you can redistribute it and/or modify
		it under the terms of the GNU General Public License as published by
		the Free Software Foundation, either version 3 of the License, or
		any later version.
		The Yolk is distributed in the hope that it will be useful,
		but WITHOUT ANY WARRANTY; without even the implied warranty of
		MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
		GNU General Public License for more details.
		You should have received a copy of the GNU General Public License
		along with The Yolk.  If not, see <http://www.gnu.org/licenses/>.
		-->
        <script>
            window.$ = window.jQuery = require('jquery');
            window.Promise = require("bluebird");
            const {ipcRenderer} = require('electron');
			const smartcrop = require('smartcrop');
            require('jquery.facedetection');
        </script>
    </head>
    <body>
        <script>
            var face = function(src,discoq){
				src = decodeURI(src);
                var promise = new Promise(function(resolve,reject){
                    var image = document.createElement('img');
                    $(image).attr('src',src);

                    image.onload = function(){
                        try{
                            $(image).faceDetection({
                                complete: function (data) {
									var confidence;
									var options = {
										width: 250,
										height:250
									}
									if (data.length){
										data.forEach(function(face){
											if(!confidence){
												confidence = face.confidence;
											}else if(face.confidence > confidence){
												confidence = face.confidence;
											}
										})
										data = data.filter(function(face){
											if(face.confidence === confidence){
												return true;
											}
										})
										var boost = data.map(function(face){
											return {
												x:face.x,
												y:face.y,
												width:face.width,
												height:face.height,
												weight:1
											}
										})
										options.boost = boost;
										smartcrop.crop(image,options).then(function(result){
											$(image).remove();
											resolve(result.topCrop)
										})
									}else{
										smartcrop.crop(image,options).then(function(result){
											$(image).remove();
											resolve(result.topCrop)
										})
									}
                                }
                            });
                        }
                        catch(err){
                            reject(err);
                        }
                    }
                })
                return promise;
            }
        </script>
    </body>
</html>
