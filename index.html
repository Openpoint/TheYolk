<!DOCTYPE html>
<html ng-app="yolk">
  <head>
    <meta charset="UTF-8">
    <title>The Yolk</title>
	<script>
		window.$ = window.jQuery = require('jquery');
		const {ipcRenderer} = require('electron');
		const Yolk = {};
		Yolk.fixChrome = function(){
			$('#chrome').clone().appendTo('#topmen').attr('height','100%');
		}
		Yolk.getModule=function(){

			var head  = document.getElementsByTagName('head')[0];
			$('head [id^=inject]').remove();
			var modname = window.location.hash.split('/')[1];
			if(!modname){
				modname = 'boot'
			}
			for(var key in Yolk.config.modules){
				var module = Yolk.config.modules[key];

				if(module.name === modname && module.css && module.css.length){
					var count = 0;
					module.css.forEach(function(css){

						var link  = document.createElement('link');
						link.rel  = 'stylesheet';
						link.type = 'text/css';
						link.media = 'all';
						link.href = css;
						link.id='inject'+count;
						count++;
						head.appendChild(link);
					})
				}
			}
		}
		Yolk.chrome = function(action){
			ipcRenderer.send('chrome',action);
		}
	</script>
	<link rel="stylesheet" type="text/css" href="./core/lib/css/reset.css">
	<link rel="stylesheet" type="text/css" href="./core/lib/css/style.css">
	<link rel="stylesheet" type="text/css" href="./core/lib/css/animations.css">
	<link rel="stylesheet" type="text/css" href="./core/lib/css/icons/style.css">
  </head>
  <body>
	<div id='chrome'>
		<div onclick="Yolk.chrome('min')" class='icon-minimise'></div>
		<div onclick="Yolk.chrome('max')" class='icon-maximise'></div>
		<div onclick="Yolk.chrome('close')" class='icon-close close'></div>
	</div>
	<ng-view></ng-view>
	<script>

		ipcRenderer.on('config',function(event,data){
			Yolk.config = data;

			require('angular');
			require('angular-route');
			require('angular-animate');
			require('./core/routing.js');

			for(var key in Yolk.config.modules){
				var module = Yolk.config.modules[key];

				//load the controllers
				if(module.controller){
					require(module.controller)
				}
				//load the services
				if(module.services && module.services.length){
					module.services.forEach(function(service){
						try{
							require(service)
						}
						catch(error){
							console.error(service+'\n', error)
						}

					})
				}
				//load the filters
				if(module.filters && module.filters.length){
					module.filters.forEach(function(filter){
						try{
							require(filter)
						}
						catch(error){
							console.error(filter+'\n', error)
						}

					})
				}
			}

		})
		ipcRenderer.on('log',function(event,data){
			console.log(data);
		})
        ipcRenderer.on('json',function(event,data){
            data = JSON.parse(data);
			console.log(data);
		})
		ipcRenderer.on('error',function(event,data){
			console.error(data);
		})
		ipcRenderer.send('ready');
	</script>
  </body>
</html>
