<!DOCTYPE html>
<html ng-app="yolk">
  <head>
    <meta charset="UTF-8">
    <title>The Yolk</title>
	<script>
		window.$ = window.jQuery = require('jquery');
	</script>
	<link rel="stylesheet" type="text/css" href="./core/reset.css">
  </head>
  <body>
	<ng-view></ng-view>
	<script>
		const {ipcRenderer} = require('electron');
		ipcRenderer.send('return', 'config');
		ipcRenderer.on('config',function(event,data){
			window.Yolk = config = data;
			config.getModule=function(){
				
				var head  = document.getElementsByTagName('head')[0];
				$('head [id^=inject]').remove();
				var modname = window.location.hash.split('/')[1];
				if(!modname){
					modname = 'musicPlayer'
				}
				for(var key in config.modules){
					var module = config.modules[key];
					
					if(module.name === modname && module.css && module.css.length){
						var count = 0;
						module.css.forEach(function(css){
							
							var link  = document.createElement('link');
							link.rel  = 'stylesheet';
							link.type = 'text/css';
							link.media = 'all';
							link.href = css;
							link.id='inject'+count;
							count++;
							head.appendChild(link);
						})
					}
				}
			}
			require('angular');
			require('angular-route');
			require('angular-animate');
			require('./core/routing.js');
			
			for(var key in config.modules){
				var module = config.modules[key];
				
				//load the controllers
				if(module.controller){
					require(module.controller)
				}
				//load the services
				if(module.services && module.services.length){
					module.services.forEach(function(service){
						try{
							require(service)
						}
						catch(error){
							console.error(service+'\n', error)
						}
						
					})
				}
				//load the filters
				if(module.filters && module.filters.length){
					module.filters.forEach(function(filter){
						try{
							require(filter)
						}
						catch(error){
							console.error(filter+'\n', error)
						}
						
					})
				}
			}
		})
		ipcRenderer.on('log',function(event,data){
			console.log(data);
		})
		ipcRenderer.on('error',function(event,data){
			console.error(data);
		})
	</script>
  </body>
</html>

